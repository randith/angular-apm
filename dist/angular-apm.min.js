(function(e){"use strict";e.module("perfMonitor",[]).provider("perfMonitor",function(){function n(){a={},d=[],s=0,l=void 0,c=void 0}function r(e,r,t){if(0===d.length&&!c)return console.debug("No results met reportThreshold"),n(),void 0;if(c){var i=new Date-c;d.push(l+":"+i)}if(o.logMetrics&&console.log("%o=%o",e,d),o.beaconUrl){t.disable();var a={};a[e]=encodeURI(""+d),r({method:"GET",url:o.beaconUrl,params:a}).then(function(){n(),t.enable()})}else n()}var o={logMetrics:!0,reportThreshold:10,beaconUrl:void 0,enabled:!0,reportOnEndView:!1},t="$digest",i=!1,a={},d=[],s=0,l=void 0,c=void 0;this.setOptions=function(n){e.extend(o,n)},this.$get=function(e){function f(){}return f.disable=function(){o.enabled=!1},f.enable=function(){o.enabled=!0},f.startView=function(e){if(o.enabled){if(l)return console.warn('Called startView "%o" when previous view "%o" not ended'),void 0;n(),l=e,c=new Date}},f.endView=function(){return o.enabled?o.reportOnEndView?l?(r(l,e,this),void 0):(console.warn("Called endView when view not started"),void 0):(console.warn("Called endView with reportOnEndView set to false"),void 0):void 0},f.startMarker=function(e){if(o.enabled){if(a.hasOwnProperty(e))return console.warn("Tried to create duplicate active performance marker name: "+e),void 0;if(o.reportOnEndView&&!l)return e!==t&&console.warn('Called startMarker "%o" with reportOnEndView when view not started',e),void 0;a[e]=new Date,s++}},f.endMarker=function(n){if(o.enabled){if(!a.hasOwnProperty(n))return n!==t&&console.warn("Tried to end nonexistent performance marker: "+n),void 0;var c=new Date-a[n];if(c>=o.reportThreshold&&d.push(n+":"+c),delete a[n],s--,!o.reportOnEndView&&0===s){if(i&&n!==t)return;l?r(l,e,this):r("markers",e,this)}}},f.monitorDigest=function(e){if(o.enabled){i=!0;var n=e.$digest,r=this;e.$digest=function(){r.startMarker(t),n.apply(e),r.endMarker(t)}}},f}})})(window.angular);