(function(e){"use strict";e.module("perfMonitor",[]).provider("perfMonitor",function(){var n={logMetrics:!0,reportThreshold:10,beaconUrl:void 0,enabled:!0},r="$digest",t=!1,o={},i=[],a=0;this.setOptions=function(r){e.extend(n,r)},this.$get=function(e){function s(){}return s.disable=function(){n.enabled=!1},s.enable=function(){n.enabled=!0},s.startMarker=function(e){if(n.enabled){if(o.hasOwnProperty(e))return console.warn("Tried to create duplicate active performance marker name: "+e),void 0;o[e]=new Date,a++}},s.endMarker=function(s){if(n.enabled){if(!o.hasOwnProperty(s))return s!==r&&console.warn("Tried to end nonexistent performance marker: "+s),void 0;var d=new Date-o[s];if(d>=n.reportThreshold&&i.push(s+":"+d),delete o[s],a--,0===a){if(t&&s!==r)return;if(n.logMetrics&&console.log("markers=%o",i),n.beaconUrl){this.disable();var l=this;e({method:"GET",url:n.beaconUrl,params:{markers:encodeURI(""+i)}}).then(function(){i=[],l.enable()})}else i=[]}}},s.monitorDigest=function(e){if(n.enabled){t=!0;var o=e.$digest,i=this;e.$digest=function(){i.startMarker(r),o.apply(e),i.endMarker(r)}}},s}})})(window.angular);