(function(e){"use strict";e.module("perfMonitor",[]).provider("perfMonitor",function(){function n(e,n,t){r.logMetrics&&console.log("%o=%o",e,a);var o={};o[e]=encodeURI(""+a),r.beaconUrl?(t.disable(),n({method:"GET",url:r.beaconUrl,params:o}).then(function(){a=[],t.enable()})):a=[]}var r={logMetrics:!0,reportThreshold:10,beaconUrl:void 0,enabled:!0,reportOnEndView:!1},t="$digest",o=!1,i={},a=[],d=0,s=void 0,l=void 0;this.setOptions=function(n){e.extend(r,n)},this.$get=function(e){function c(){}return c.disable=function(){r.enabled=!1},c.enable=function(){r.enabled=!0},c.startView=function(e){if(r.enabled){if(s)return console.warn('Called startView "%o" when previous view "%o" not ended'),void 0;s=e,d=0,i={},a=[],l=new Date}},c.endView=function(){return r.enabled?r.reportOnEndView?s?(n(s,e,this),void 0):(console.warn("Called endView when view not started"),void 0):(console.warn("Called endView with reportOnEndView set to false"),void 0):void 0},c.startMarker=function(e){if(r.enabled){if(i.hasOwnProperty(e))return console.warn("Tried to create duplicate active performance marker name: "+e),void 0;if(r.reportOnEndView&&!s)return e!==t&&console.warn('Called startMarker "%o" with reportOnEndView when view not started',e),void 0;i[e]=new Date,d++}},c.endMarker=function(l){if(r.enabled){if(!i.hasOwnProperty(l))return l!==t&&console.warn("Tried to end nonexistent performance marker: "+l),void 0;var c=new Date-i[l];if(c>=r.reportThreshold&&a.push(l+":"+c),delete i[l],d--,!r.reportOnEndView&&0===d){if(o&&l!==t)return;s?n(s,e,this):n("markers",e,this)}}},c.monitorDigest=function(e){if(r.enabled){o=!0;var n=e.$digest,i=this;e.$digest=function(){i.startMarker(t),n.apply(e),i.endMarker(t)}}},c}})})(window.angular);